<!-- Toast para mensagens -->
<p-toast position="top-right"></p-toast>

<!-- Modal de Cadastro -->
<p-dialog 
  [(visible)]="visible" 
  [modal]="true" 
  [closable]="true"
  [draggable]="false"
  [resizable]="false"
  [header]="modoEdicao ? 'Editar Barbearia' : 'Nova Barbearia'"
  [style]="{width: '90vw', maxWidth: '800px'}"
  [breakpoints]="{'960px': '75vw', '641px': '90vw'}"
  (onHide)="hide()">
  
  <form [formGroup]="barbeariaForm" (ngSubmit)="onSubmit()" class="modal-form">
    
    <!-- Informações Básicas -->
    <div class="form-section">
      <h3 class="section-title">
        <i class="pi pi-info-circle"></i>
        Informações Básicas
      </h3>
      
      <div class="form-row">
        <div class="form-field">
          <label for="nome">Nome da Barbearia *</label>
          <input 
            id="nome"
            type="text" 
            pInputText 
            formControlName="nome"
            placeholder="Digite o nome da barbearia"
            [class.invalid]="isFieldInvalid('nome')">
          <small class="error-message" *ngIf="isFieldInvalid('nome')">
            {{ getFieldError('nome') }}
          </small>
        </div>
        
        <div class="form-field">
          <label for="cnpj">CNPJ *</label>
          <p-inputMask 
            id="cnpj"
            formControlName="cnpj"
            mask="99.999.999/9999-99"
            placeholder="00.000.000/0000-00"
            [class.invalid]="isFieldInvalid('cnpj')">
          </p-inputMask>
          <small class="error-message" *ngIf="isFieldInvalid('cnpj')">
            {{ getFieldError('cnpj') }}
          </small>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-field">
          <label for="telefone">Telefone *</label>
          <p-inputMask 
            id="telefone"
            formControlName="telefone"
            mask="(99) 99999-9999"
            placeholder="(00) 00000-0000"
            [class.invalid]="isFieldInvalid('telefone')">
          </p-inputMask>
          <small class="error-message" *ngIf="isFieldInvalid('telefone')">
            {{ getFieldError('telefone') }}
          </small>
        </div>
        
        <div class="form-field">
          <label for="email">Email *</label>
          <input 
            id="email"
            type="email" 
            pInputText 
            formControlName="email"
            placeholder="contato@barbearia.com"
            [class.invalid]="isFieldInvalid('email')">
          <small class="error-message" *ngIf="isFieldInvalid('email')">
            {{ getFieldError('email') }}
          </small>
        </div>
      </div>
    </div>

    <!-- Endereço -->
    <div class="form-section">
      <h3 class="section-title">
        <i class="pi pi-map-marker"></i>
        Endereço
      </h3>
      
      <div class="form-row">
        <div class="form-field">
          <label for="cep">CEP *</label>
          <p-inputMask 
            id="cep"
            formControlName="cep"
            mask="99999-999"
            placeholder="00000-000"
            [class.invalid]="isFieldInvalid('cep')">
          </p-inputMask>
          <small class="error-message" *ngIf="isFieldInvalid('cep')">
            {{ getFieldError('cep') }}
          </small>
        </div>
        
        <div class="form-field">
          <label for="estado">Estado *</label>
          <select 
            id="estado"
            formControlName="estado"
            [class.invalid]="isFieldInvalid('estado')">
            <option value="">Selecione o estado</option>
            <option *ngFor="let estado of estados" [value]="estado">
              {{ estado }}
            </option>
          </select>
          <small class="error-message" *ngIf="isFieldInvalid('estado')">
            {{ getFieldError('estado') }}
          </small>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-field">
          <label for="cidade">Cidade *</label>
          <input 
            id="cidade"
            type="text" 
            pInputText 
            formControlName="cidade"
            placeholder="Digite a cidade"
            [class.invalid]="isFieldInvalid('cidade')">
          <small class="error-message" *ngIf="isFieldInvalid('cidade')">
            {{ getFieldError('cidade') }}
          </small>
        </div>
        
        <div class="form-field">
          <label for="bairro">Bairro *</label>
          <input 
            id="bairro"
            type="text" 
            pInputText 
            formControlName="bairro"
            placeholder="Digite o bairro"
            [class.invalid]="isFieldInvalid('bairro')">
          <small class="error-message" *ngIf="isFieldInvalid('bairro')">
            {{ getFieldError('bairro') }}
          </small>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-field">
          <label for="rua">Rua *</label>
          <input 
            id="rua"
            type="text" 
            pInputText 
            formControlName="rua"
            placeholder="Digite a rua"
            [class.invalid]="isFieldInvalid('rua')">
          <small class="error-message" *ngIf="isFieldInvalid('rua')">
            {{ getFieldError('rua') }}
          </small>
        </div>
        
        <div class="form-field">
          <label for="numero">Número *</label>
          <input 
            id="numero"
            type="text" 
            pInputText 
            formControlName="numero"
            placeholder="Digite o número"
            [class.invalid]="isFieldInvalid('numero')">
          <small class="error-message" *ngIf="isFieldInvalid('numero')">
            {{ getFieldError('numero') }}
          </small>
        </div>
      </div>
    </div>

    <!-- Horário de Funcionamento -->
    <div class="form-section">
      <h3 class="section-title">
        <i class="pi pi-clock"></i>
        Horário de Funcionamento
      </h3>
      
      <div class="form-row">
        <div class="form-field">
          <label for="horaAbertura">Hora de Abertura *</label>
          <select 
            id="horaAbertura"
            formControlName="horaAbertura"
            [class.invalid]="isFieldInvalid('horaAbertura')">
            <option *ngFor="let hora of horarios" [value]="hora">
              {{ hora }}
            </option>
          </select>
          <small class="error-message" *ngIf="isFieldInvalid('horaAbertura')">
            {{ getFieldError('horaAbertura') }}
          </small>
        </div>
        
        <div class="form-field">
          <label for="horaFechamento">Hora de Fechamento *</label>
          <select 
            id="horaFechamento"
            formControlName="horaFechamento"
            [class.invalid]="isFieldInvalid('horaFechamento')">
            <option *ngFor="let hora of horarios" [value]="hora">
              {{ hora }}
            </option>
          </select>
          <small class="error-message" *ngIf="isFieldInvalid('horaFechamento')">
            {{ getFieldError('horaFechamento') }}
          </small>
        </div>
      </div>
    </div>
  </form>

  <!-- Loading -->
  <div class="loading-overlay" *ngIf="loading">
    <p-progressSpinner 
      strokeWidth="4" 
      fill="var(--surface-color)" 
      animationDuration=".5s">
    </p-progressSpinner>
    <p>{{ modoEdicao ? 'Atualizando barbearia...' : 'Cadastrando barbearia...' }}</p>
  </div>

  <!-- Footer do Modal -->
  <ng-template pTemplate="footer">
    <div class="modal-footer">
      <button 
        pButton 
        type="button" 
        label="Cancelar" 
        class="p-button-text"
        (click)="hide()"
        [disabled]="loading">
      </button>
      
      <button 
        pButton 
        type="submit" 
        [label]="modoEdicao ? 'Atualizar Barbearia' : 'Cadastrar Barbearia'" 
        icon="pi pi-check"
        class="p-button-success"
        (click)="onSubmit()"
        [disabled]="loading || barbeariaForm.invalid">
      </button>
    </div>
  </ng-template>
</p-dialog> 